<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audio Phase Transition</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
<script>
    const audioCtx = new window.AudioContext();
    const gainNode = audioCtx.createGain();

</script>


<h1>Audio Phase Transitions</h1>
<div id="info"></div>
<div class="slidecontainer">
    Volume: <input type="range" min="0" max="100" value="20"  class="slider" id="volumeRange">
</div>
<button type="button" onclick="activateAudio()" id="activate">Activate Audio</button>
<button type="button" onclick="play()">Play</button>
<script>
    const info  = document.getElementById("info");
    info.innerHTML=`Sample Rate: ${audioCtx.sampleRate}`
    function activateAudio() {
        audioCtx.resume();
        document.getElementById("activate").disabled = true
    }

    function play() {

        // Create an empty three-second stereo buffer at the sample rate of the AudioContext
        let myArrayBuffer = audioCtx.createBuffer(2, audioCtx.sampleRate * 3, audioCtx.sampleRate);

        // Fill the buffer with white noise;
        // just random values between -1.0 and 1.0
        for (let channel = 0; channel < myArrayBuffer.numberOfChannels; channel++) {
            // This gives us the actual array that contains the data
            let nowBuffering = myArrayBuffer.getChannelData(channel);
            for (let i = 0; i < myArrayBuffer.length; i++) {
                // Math.random() is in [0; 1.0]
                // audio needs to be in [-1.0; 1.0]
                nowBuffering[i] = Math.random() * 2 - 1;
            }
        }

        // Get an AudioBufferSourceNode.
        // This is the AudioNode to use when we want to play an AudioBuffer
        let source = audioCtx.createBufferSource();

        // set the buffer in the AudioBufferSourceNode
        source.buffer = myArrayBuffer;

        gainNode.connect(audioCtx.destination)
        // connect the AudioBufferSourceNode to the
        // destination so we can hear the sound
        let volRange = document.getElementById("volumeRange");
        gainNode.gain.setValueAtTime(volRange.value/100.0, audioCtx.currentTime)
        source.connect(gainNode);

        // start the source playing
        source.start();
    }

</script>
</body>
</html>